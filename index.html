<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TikTalk - Stranger Chat</title>
  <style>
    /* ===== Full CSS merged ===== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: Arial, sans-serif;
    }

    body {
      background: linear-gradient(135deg, #74ebd5, #9face6);
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    /* ===== Header and Logo ===== */
    header {
      display: flex;
      align-items: center;
      padding: 10px 15px;
      background: rgba(255,255,255,0.8);
      backdrop-filter: blur(10px);
      height: 80px; /* Desktop header height */
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1000;
      gap: 10px;
      border-bottom: 1px solid #ddd;
    }

    header .logo {
      height: 100%;           /* Logo follows header height */
      width: auto;
      max-height: 80px;       /* Bigger logo */
      margin-right: 10px;
    }

    header h1 {
      color: #333;
      font-size: 24px;
    }

    /* ===== Chat Main ===== */
    main#chat {
      flex: 1;
      overflow-y: auto;
      padding: 90px 15px 70px; /* top header + bottom footer */
    }

    #messages {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .msg {
      max-width: 75%;
      padding: 10px 14px;
      border-radius: 15px;
      word-wrap: break-word;
      font-size: 15px;
    }

    .me { align-self: flex-end; background: #007bff; color: #fff; }
    .stranger { align-self: flex-start; background: #f1f1f1; }

    .popup {
      background: #f9f9f9;
      border: 1px solid #ddd;
      border-radius: 10px;
      padding: 15px;
      text-align: center;
      color: #555;
      max-width: 220px;
      margin: 40px auto;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      font-size: 14px;
    }

    #typingIndicator {
      font-size: 13px;
      color: #888;
      margin-top: 5px;
      text-align: left;
      font-style: italic;
    }

    /* ===== Footer ===== */
    footer {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      display: flex;
      padding: 8px;
      gap: 6px;
      border-top: 1px solid #ddd;
      background: rgba(255,255,255,0.9);
      z-index: 1000;
    }

    footer textarea {
      flex: 1;
      resize: none;
      border: 1px solid #ccc;
      border-radius: 20px;
      padding: 10px;
      font-size: 15px;
      height: 40px;
      outline: none;
    }

    footer button {
      padding: 0 14px;
      border: none;
      border-radius: 20px;
      background: #007bff;
      color: #fff;
      font-weight: bold;
      cursor: pointer;
      font-size: 14px;
      white-space: nowrap;
    }

    button#nextBtn { background: #ff3b30; }
    button:active { opacity: 0.8; }

    p.footerNote {
      text-align: center;
      padding: 5px;
      font-size: 13px;
      color: #666;
      margin-bottom: 50px;
    }

    /* ===== Responsive tweaks ===== */
    @media screen and (max-width: 600px) {
      header {
        height: 50px;       /* Mobile header height */
        padding: 6px 10px;
      }

      header .logo {
        height: 100%;
        max-height: 50px;   /* Mobile logo height */
      }

      header h1 {
        font-size: 16px;
      }

      footer textarea {
        height: 35px;
        font-size: 13px;
      }

      footer button {
        padding: 6px 10px;
        font-size: 13px;
      }
    }
  </style>
</head>
<body>
  <header>
    <!-- Inline animated logo -->
    <svg class="logo" width="40" height="40" viewBox="0 0 420 140" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="TikTalk animated logo">
      <defs>
        <linearGradient id="gBubble" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" stop-color="#00eaff">
            <animate attributeName="stop-color" dur="6s" values="#00eaff;#007bff;#6a00ff;#00eaff" repeatCount="indefinite"/>
          </stop>
          <stop offset="100%" stop-color="#007bff">
            <animate attributeName="stop-color" dur="6s" values="#007bff;#6a00ff;#00eaff;#007bff" repeatCount="indefinite"/>
          </stop>
        </linearGradient>
        <linearGradient id="gText" x1="0%" x2="100%">
          <stop offset="0%" stop-color="#00eaff"/>
          <stop offset="100%" stop-color="#6a00ff"/>
        </linearGradient>
        <filter id="softGlow" x="-50%" y="-50%" width="200%" height="200%">
          <feGaussianBlur stdDeviation="6" result="b"/>
          <feMerge>
            <feMergeNode in="b"/>
            <feMergeNode in="SourceGraphic"/>
          </feMerge>
        </filter>
      </defs>

      <g transform="translate(60,70)">
        <g class="bubble">
          <circle cx="0" cy="0" r="45" fill="url(#gBubble)"/>
          <ellipse class="eye left" cx="-12" cy="-7" rx="4.5" ry="7" fill="#fff"/>
          <path class="eye right" d="M 8 -7 Q 12 -11 16 -7" stroke="#fff" stroke-width="2.5" stroke-linecap="round" fill="none"/>
          <path class="smile" d="M -15 8 Q 0 22 15 8" stroke="#fff" stroke-width="3" stroke-linecap="round" fill="none"/>
        </g>
        <text x="70" y="20" font-size="56" font-family="Segoe UI, Arial, sans-serif" font-weight="800" fill="url(#gText)">
          TikTalk
        </text>
      </g>
    </svg>
  </header>

  <main id="chat">
    <div id="messages"></div>
    <div id="typingIndicator" style="display:none;">Stranger is typing...</div>
  </main>

  <footer>
    <textarea id="messageInput" placeholder="Type a message..."></textarea>
    <button id="sendBtn">Send</button>
    <button id="nextBtn">Next</button>
  </footer>

  <p class="footerNote">Made in India ‚ô•Ô∏è</p>

  <script>
    window.TIKTALK_BACKEND = "https://tiktalk-server-8dmz.onrender.com";

    const messagesDiv = document.getElementById("messages");
    const input = document.getElementById("messageInput");
    const sendBtn = document.getElementById("sendBtn");
    const nextBtn = document.getElementById("nextBtn");
    const typingIndicator = document.getElementById("typingIndicator");

    let ws, typingTimeout;

    function addMessage(text, who){
      const div = document.createElement("div");
      div.className = "msg " + who;
      div.textContent = text;
      messagesDiv.appendChild(div);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }

    function showPopup(text){
      messagesDiv.innerHTML = `<div class="popup">${text}</div>`;
    }

    function connectStranger(){
      showPopup("üîç Searching for a stranger...");
      typingIndicator.style.display = "none";

      ws = new WebSocket(window.TIKTALK_BACKEND.replace("http","ws") + "/ws");

      ws.onopen = () => {
        showPopup("‚úÖ Connected! Say Hi üëã");
      };

      ws.onmessage = (event) => {
        try {
          const data = JSON.parse(event.data);
          if(data.type === "message"){
            typingIndicator.style.display = "none";
            addMessage(data.text, "stranger");
          } else if(data.type === "typing"){
            typingIndicator.style.display = "block";
            clearTimeout(typingTimeout);
            typingTimeout = setTimeout(()=> {
              typingIndicator.style.display = "none";
            }, 1500);
          }
        } catch {
          typingIndicator.style.display = "none";
          addMessage(event.data, "stranger");
        }
      };

      ws.onclose = () => {
        showPopup("‚ùå Stranger disconnected");
        typingIndicator.style.display = "none";
      };
    }

    sendBtn.addEventListener("click", ()=>{
      if(input.value.trim() && ws && ws.readyState === WebSocket.OPEN){
        ws.send(JSON.stringify({type:"message", text:input.value}));
        addMessage(input.value, "me");
        input.value="";
      }
    });

    input.addEventListener("input", ()=>{
      if(ws && ws.readyState === WebSocket.OPEN){
        ws.send(JSON.stringify({type:"typing"}));
      }
    });

    nextBtn.addEventListener("click", ()=>{
      if(ws){ ws.close(); }
      connectStranger();
    });

    connectStranger();
  </script>
</body>
</html>