<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TikTalk - Stranger Chat</title>
  <style>
    * {margin:0; padding:0; box-sizing:border-box; font-family: Arial, sans-serif;}
    body {background:#fff; display:flex; flex-direction:column; height:100vh;}

    header {
      display:flex; align-items:center; justify-content:center;
      padding:10px; border-bottom:1px solid #ddd;
    }
    header img.logo {height:35px;}

    #chat {flex:1; overflow-y:auto; padding:15px;}
    #messages {display:flex; flex-direction:column; gap:8px;}

    .msg {
      max-width:70%; padding:10px 14px; border-radius:15px;
      word-wrap:break-word; font-size:15px;
    }
    .me {align-self:flex-end; background:#007bff; color:#fff;}
    .stranger {align-self:flex-start; background:#f1f1f1;}

    footer {
      display:flex; padding:8px; border-top:1px solid #ddd; gap:6px;
    }
    textarea {
      flex:1; resize:none; padding:10px;
      border:1px solid #ccc; border-radius:20px; font-size:15px;
      outline:none; height:40px;
    }
    button {
      padding:0 14px; border:none; border-radius:20px;
      background:#007bff; color:#fff; font-weight:bold; cursor:pointer;
      font-size:14px;
    }
    button#nextBtn {background:#ff3b30;}
    button:active {opacity:0.8;}

    p.footerNote {text-align:center; padding:5px; font-size:13px; color:#666;}
  </style>
</head>
<body>
  <header>
    <img src="assets/logo.svg" alt="TikTalk Logo" class="logo" />
  </header>

  <main id="chat">
    <div id="messages"></div>
  </main>

  <footer>
    <textarea id="messageInput" placeholder="Type a message..."></textarea>
    <button id="sendBtn">Send</button>
    <button id="nextBtn">Next</button>
  </footer>
  <p class="footerNote">Made in India ‚ô•Ô∏è</p>

  <script>
    window.TIKTALK_BACKEND = "https://tiktalk-server.onrender.com";

    const messagesDiv = document.getElementById("messages");
    const input = document.getElementById("messageInput");
    const sendBtn = document.getElementById("sendBtn");
    const nextBtn = document.getElementById("nextBtn");

    let ws;

    function addMessage(text, who){
      const div = document.createElement("div");
      div.className = "msg " + who;
      div.textContent = text;
      messagesDiv.appendChild(div);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }

    function connectStranger(){
      messagesDiv.innerHTML = `<p style="text-align:center;color:#888;">üîç Searching for a stranger...</p>`;

      ws = new WebSocket(window.TIKTALK_BACKEND.replace("http","ws") + "/ws");

      ws.onopen = () => {
        messagesDiv.innerHTML = `<p style="text-align:center;color:green;">‚úÖ Connected! Say Hi üëã</p>`;
      };

      ws.onmessage = (event) => {
        addMessage(event.data, "stranger");
      };

      ws.onclose = () => {
        addMessage("‚ùå Stranger disconnected", "stranger");
      };
    }

    sendBtn.addEventListener("click", ()=>{
      if(input.value.trim() && ws && ws.readyState === WebSocket.OPEN){
        ws.send(input.value);
        addMessage(input.value, "me");
        input.value="";
      }
    });

    nextBtn.addEventListener("click", ()=>{
      if(ws){ ws.close(); }
      connectStranger();
    });

    // auto connect on load
    connectStranger();
  </script>
</body>
</html>