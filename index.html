<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>TikTalk - Stranger Chat</title>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/emoji-mart@latest/css/emoji-mart.css" />

<style>
* {
  margin:0;
  padding:0;
  box-sizing:border-box;
  font-family: Arial, sans-serif;
  /* User selection disabled for all elements */
  user-select: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
}
body {background:#fff; display:flex; flex-direction:column; height:100vh; transition: background .3s, color .3s; color:#0f172a;}
body.dark-mode {background:#0b0f15; color:#e5e7eb;}
header {position:fixed; top:0; left:0; right:0; display:flex; align-items:center; justify-content:space-between; padding:8px 15px; background:#fff; border-bottom:1px solid #ddd; z-index:1000;}
body.dark-mode header {background:#10161d; border-color:#374151;}
header .left, header .right {display:flex; align-items:center; gap:8px;}
header svg.logo {height:50px; width:auto; display:block;}
#chat {flex:1; overflow-y:auto; padding:70px 15px 100px;}
#messages {display:flex; flex-direction:column; gap:8px;}

/* WhatsApp-style bubbles */
.msg {
  max-width:75%;
  padding:10px 14px;
  border-radius:18px;
  word-wrap:break-word;
  font-size:15px;
  line-height:1.4;
  box-shadow:0 1px 2px rgba(0,0,0,.06);
  /* Added display:inline-block to wrap content dynamically */
  display: inline-block;
}
.me {align-self:flex-end; background:#007bff; color:#fff; border-bottom-right-radius:6px;}
.stranger {align-self:flex-start; background:#e5e5ea; color:#0f172a; border-bottom-left-radius:6px;}

.popup {background:transparent; border:none; padding:8px; text-align:center; color:#555; max-width:220px; margin:8px auto; font-size:14px;}
body.dark-mode .popup {background:transparent; color:#e5e7eb;}
#typingIndicator {font-size:13px; color:#888; margin-top:5px; text-align:left; font-style:italic;}

/* Footer layout */
footer {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  display: flex;
  align-items: center;
  padding: 8px;
  border-top: 1px solid #ddd;
  gap: 6px;
  background: #fff;
  z-index: 1400;
  min-height: 50px;
  overflow: hidden;
}
body.dark-mode footer {background:#10161d; border-color:#374151;}

/* Footer note (Made in India) */
.footerNote {position: fixed; bottom: 60px; left: 0; right: 0; text-align: center; font-size: 14px; color: #555; z-index: 999;}
.footerNote .heart {
    color: #ff0000; /* Made the heart red */
}
body.dark-mode .footerNote {color: #e5e7eb;}

/* Input wrapper with WhatsApp-style toggle inside textarea */
.inputWrapper {flex: 1; position: relative; display: flex; align-items: center;}
textarea {width: 100%; resize: none; padding: 10px 44px 10px 44px; border: 1px solid #ccc; border-radius: 20px; font-size: 15px; outline: none; height: 40px; background: #fff; color: #0f172a;}
body.dark-mode textarea {background: #1f2937; color: #e5e7eb; border-color: #374151;}

/* Emoji/Keyboard toggle inside textarea (left) */
#emojiToggle {
  position: absolute;
  left: 10px;
  top: 50%;
  transform: translateY(-50%);
  background: transparent;
  border: none;
  font-size: 20px;
  cursor: pointer;
  line-height: 1;
  width: 24px;
  height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  -webkit-tap-highlight-color: transparent !important;
}

/* Send / Next buttons */
button {
  padding: 0 14px;
  border: none;
  border-radius: 20px;
  background: #007bff;
  color: #fff;
  font-weight: bold;
  cursor: pointer;
  font-size: 14px;
  white-space: nowrap;
  -webkit-tap-highlight-color: transparent !important;
  display: flex;
  align-items: center;
  justify-content: center;
}
button:active {opacity: 0.85;}
#sendBtn, #nextBtn {width: 40px; height: 40px; border-radius: 50%; padding: 0;}
#sendBtn {order: 3;}
#nextBtn {order: 0; background: #ff3b30; margin-right: auto;}

/* Emoji picker popup */
#emojiPicker {
  position: fixed;
  left: 0;
  right: 0;
  bottom: 0;
  z-index: 2000;
  display: none;
  background: #fff;
  border-top: 1px solid #ddd;
}
body.dark-mode #emojiPicker {
  background: #1f2937;
  border-top-color: #374151;
}

/* Header right actions */
.icon-btn, .share-btn {border-radius: 999px; height: 36px; cursor: pointer; font-weight: 600; transition: all .2s; display: flex; align-items: center; justify-content: center;}
.icon-btn {width: 36px; background: transparent; border: none; font-size: 18px;}
.icon-btn:active {transform: scale(.95);}
.share-btn {padding: 0; background: green; border: none; width: 36px; height: 36px; position: relative; color: #fff;}
.share-btn:hover {opacity: 0.85;}

/* Share sheet */
.right { position: relative; }
.share-sheet { position: absolute; top: 100%; right: 0; background: #fff !important; border-radius: 12px; padding: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.15); display: none; flex-direction: row; gap: 12px; z-index: 1000; margin-top: 5px; transform: translateY(-10px); opacity: 0; transition: all 0.3s ease;}
body.dark-mode .share-sheet { background: #1f2937 !important; box-shadow: 0 4px 20px rgba(0,0,0,0.4);}
.share-sheet.show { transform: translateY(0); opacity: 1;}
.share-sheet button { background: #f8f9fa !important; border: 1px solid #dee2e6 !important; border-radius: 50%; padding: 8px; width: 44px; height: 44px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s ease;}
.share-sheet button:hover { background: #e9ecef !important; transform: scale(1.05);}
body.dark-mode .share-sheet button {background: #2d3748 !important; border-color: #4a5568 !important;}
body.dark-mode .share-sheet button:hover {background: #4a5568 !important;}
.share-sheet button img { width: 24px; height: 24px;}
.share-sheet button svg { display: block;}
.share-sheet .link { border-radius: 50%; width: 44px; height: 44px; display: flex; align-items: center; justify-content: center; background: #f8f9fa !important; border: 1px solid #dee2e6 !important; color: #007bff !important; font-weight: 600; cursor: pointer; transition: all 0.2s ease;}
.share-sheet .link:hover { background: #e9ecef !important; transform: scale(1.05); }

/* Remove focus glow */
button:focus, button:active,
.icon-btn:focus, .icon-btn:active,
.share-btn:focus, .share-btn:active,
.share-sheet button:focus, .share-sheet button:active,
button:focus-visible, .icon-btn:focus-visible,
.share-btn:focus-visible, .share-sheet button:focus-visible { outline: none !important; box-shadow: none !important; }

/* Copy popup */
#copyLinkPopup {
    position: absolute;
    top: calc(100% + 15px);
    right: 0;
    padding: 12px 20px;
    border-radius: 25px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.25);
    font-size: 14px;
    font-weight: 600;
    opacity: 0;
    transition: opacity 0.3s ease;
    z-index: 2000;
    pointer-events: none;
    color: #fff;
    background: #007bff;
    transform: translateY(-10px);
}
#copyLinkPopup.show {
    opacity: 1;
    transform: translateY(0);
}
body.dark-mode #copyLinkPopup { background: #1d4ed8; color: #fff; box-shadow: 0 4px 12px rgba(0,0,0,0.4);}

/* Animations (logo/search/connected) */
.bubble {transform-origin: 50% 50%; animation: bubblePulse 3.6s ease-in-out infinite, bubbleRotate 8s linear infinite;}
.eye {transform-origin: center; animation: eyePop 2s ease-in-out infinite;}
.smile {animation: smileJelly 2.6s cubic-bezier(.25,.9,.3,1) infinite;}
@keyframes bubblePulse {0%,100%{transform: scale(1);}50%{transform: scale(1.05);}}
@keyframes bubbleRotate {0%{transform: rotate(-1deg);}50%{transform: rotate(1deg);}100%{transform: rotate(-1deg);}}
@keyframes eyePop {0%,100%{transform: translateY(0);opacity: 1;}40%,60%{transform: translateY(-20px);opacity: 0;}}
@keyframes smileJelly {0%,100%{transform: translateY(0);}40%{transform: translateY(2px) scaleY(.95);}70%{transform: translateY(-1px) scaleY(1.05);}}

.searching-container{display: flex;justify-content: center;align-items: center;padding: 15px 0;}
.pulse-dots{display: flex;align-items: center;justify-content: center;gap: 4px;}
.pulse-dot{width: 10px;height: 10px;border-radius: 50%;background: linear-gradient(45deg,#00eaff,#6a00ff);animation: pulse 1.5s ease-in-out infinite;}
.pulse-dot:nth-child(1){animation-delay: 0s;} .pulse-dot:nth-child(2){animation-delay: .2s;} .pulse-dot:nth-child(3){animation-delay: .4s;}
@keyframes pulse{0%,100%{transform: scale(.8);opacity: .7;}50%{transform: scale(1.2);opacity: 1;}}
.searching-text{margin-left: 10px;font-weight: 500;color: #555;white-space: nowrap;}
body.dark-mode .searching-text{color: #e5e7eb;}
.connected-checkmark{display: inline-block;width: 20px;height: 20px;margin-right: 8px;}
.connected-checkmark::after{content: "";display: block;width: 8px;height: 14px;border: solid #00c853;border-width: 0 3px 3px 0;transform: rotate(45deg);animation: checkmark-appear .5s ease-in-out;}
@keyframes checkmark-appear{0%{opacity: 0;transform: rotate(45deg) scale(0);}50%{transform: rotate(45deg) scale(1.2);}100%{opacity: 1;transform: rotate(45deg) scale(1);}}

.start-chatting-btn{position: fixed;bottom: 90px;left: 50%;transform: translateX(-50%);padding: 12px 24px;background: #007bff;color: #fff;border: none;border-radius: 25px;font-weight: bold;font-size: 16px;cursor: pointer;box-shadow: 0 4px 15px rgba(0,0,0,0.2);z-index: 999;animation: pulse-glow 2s infinite;display: block;}
body.dark-mode .start-chatting-btn{background: #007bff;box-shadow: 0 4mpx 15px rgba(0,123,255,0.4);}
@keyframes pulse-glow{0%{box-shadow: 0 4px 15px rgba(0,123,255,0.4);transform: translateX(-50%) scale(1);}50%{box-shadow: 0 4px 20px rgba(0,123,255,0.7);transform: translateX(-50%) scale(1.05);}100%{box-shadow: 0 4px 15px rgba(0,123,255,0.4);transform: translateX(-50%) scale(1);}}
.start-chatting-btn:hover{animation: none;box-shadow: 0 4px 20px rgba(0,123,255,0.8);transform: translateX(-50%) scale(1.05);}

/* Button icons */
.button-icon { width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; }

/* Smooth scroll for new messages */
.auto-scroll-enabled #messages { scroll-behavior: smooth; }
</style>
</head>
<body>
<header>
  <div class="left">
    <svg class="logo" width="auto" height="50" viewBox="0 0 420 140" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="TikTalk animated logo">
      <defs>
        <linearGradient id="gBubble" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" stop-color="#00eaff">
            <animate attributeName="stop-color" dur="6s" values="#00eaff;#007bff;#6a00ff;#00eaff" repeatCount="indefinite"/>
          </stop>
          <stop offset="100%" stop-color="#007bff">
            <animate attributeName="stop-color" dur="6s" values="#007bff;#6a00ff;#00eaff;#007bff" repeatCount="indefinite"/>
          </stop>
        </linearGradient>
        <filter id="softGlow" x="-50%" y="-50%" width="200%" height="200%">
          <feGaussianBlur stdDeviation="6" result="b"/>
          <feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge>
        </filter>
      </defs>
      <g transform="translate(60,70)">
        <g class="bubble">
          <circle cx="0" cy="0" r="45" fill="url(#gBubble)"/>
          <ellipse class="eye left" cx="-12" cy="-7" rx="4.5" ry="7" fill="#fff"/>
          <path class="eye right" d="M 8 -7 Q 12 -11 16 -7" stroke="#fff" stroke-width="2.5" stroke-linecap="round" fill="none"/>
          <path class="smile" d="M -15 8 Q 0 22 15 8" stroke="#fff" stroke-width="3" stroke-linecap="round" fill="none"/>
        </g>
        <text x="70" y="20" font-size="56" font-family="Segoe UI, Arial, sans-serif" font-weight="800" fill="#007bff">TikTalk</text>
      </g>
    </svg>
  </div>
  <div class="right">
    <button id="themeToggle" class="icon-btn">üåô</button>
    <button id="shareBtn" class="share-btn">
      <svg class="button-icon" viewBox="0 0 24 24" fill="white">
        <path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.70s-.04-.47-.09-.70l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.70L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z"/>
      </svg>
    </button>
    <div class="share-sheet" id="shareSheet">
      <button onclick="shareApp('whatsapp')"><img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="WhatsApp"></button>
      <button onclick="shareApp('instagram')"><img src="https://upload.wikimedia.org/wikipedia/commons/a/a5/Instagram_icon.png" alt="Instagram"></button>
      <button onclick="shareApp('facebook')"><img src="https://upload.wikimedia.org/wikipedia/commons/0/05/Facebook_Logo_%282019%29.png" alt="Facebook"></button>
      <button onclick="shareApp('x')" aria-label="Share on X">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="20" height="20">
          <circle cx="50" cy="50" r="50" fill="#1DA1F2"/>
          <path d="M30,30 L70,70 M70,30 L30,70" stroke="#fff" stroke-width="10" stroke-linecap="round"/>
        </svg>
      </button>
      <button class="link" onclick="shareApp('link')">üîó</button>
    </div>
  </div>
</header>

<main id="chat">
  <div id="messages"></div>
  <div id="typingIndicator" style="display:none;">Stranger is typing...</div>
</main>

<button id="startChattingBtn" class="start-chatting-btn">Start Chat</button>

<p class="footerNote">Made in India <span class="heart">‚ô•Ô∏è</span></p>

<footer>
  <button id="nextBtn" title="Next">
    <svg class="button-icon" viewBox="0 0 24 24" fill="white">
      <path d="M12 6v3l4-4-4-4v3c-4.42 0-8 3.58-8 8 0 1.57.46 3.03 1.24 4.26L6.7 14.8c-.45-.83-.7-1.79-.7-2.8 0-3.31 2.69-6 6-6zm6.76 1.74L17.3 9.2c.44.84.7 1.79.7 2.8 0 3.31-2.69 6-6 6v-3l-4 4 4 4v-3c4.42 0 8-3.58 8-8 0-1.57-.46-3.03-1.24-4.26z"/>
    </svg>
  </button>

  <div class="inputWrapper">
    <button id="emojiToggle" aria-label="Emoji">üòä</button>
    <textarea id="messageInput" placeholder="Type a message..."></textarea>
  </div>

  <button id="sendBtn" title="Send">
    <svg class="button-icon" viewBox="0 0 24 24" fill="white">
      <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
    </svg>
  </button>
</footer>

<div id="emojiPicker" aria-hidden="true"></div>

<script src="https://cdn.jsdelivr.net/npm/emoji-mart@latest/dist/browser.js"></script>

<script>
// Theme toggle
const themeToggle = document.getElementById("themeToggle");
themeToggle.addEventListener("click", () => {
  document.body.classList.toggle("dark-mode");
  themeToggle.textContent = document.body.classList.contains("dark-mode") ? "‚òÄÔ∏è" : "üåô";
  if (window._emojiPickerInstance) {
    window._emojiPickerInstance.setOptions({
      theme: document.body.classList.contains("dark-mode") ? "dark" : "light"
    });
  }
});

// Share sheet
const shareBtn = document.getElementById("shareBtn");
const shareSheet = document.getElementById("shareSheet");
const startChattingBtn = document.getElementById("startChattingBtn");

shareBtn.addEventListener("click", (e) => {
  e.stopPropagation();
  const btnRect = shareBtn.getBoundingClientRect();
  shareSheet.style.top = (btnRect.bottom + window.scrollY) + "px";
  shareSheet.style.right = (window.innerWidth - btnRect.right) + "px";
  shareSheet.classList.toggle('show');
  if(shareSheet.classList.contains('show')) shareSheet.style.display = 'flex';
  else setTimeout(()=>{shareSheet.style.display='none';},300);
});
document.addEventListener("click", (e) => {
  if(!shareSheet.contains(e.target) && e.target !== shareBtn && shareSheet.classList.contains('show')){
    shareSheet.classList.remove('show');
    setTimeout(()=>{shareSheet.style.display='none';},300);
  }
});

startChattingBtn.addEventListener("click", () => {
  if(ws) ws.close();
  connectStranger();
});

function shareApp(platform){
  let url = window.location.href;
  if(platform==="whatsapp") window.open("https://api.whatsapp.com/send?text="+encodeURIComponent(url),"_blank");
  else if(platform==="instagram") window.open("https://www.instagram.com/","_blank");
  else if(platform==="facebook") window.open("https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(url),"_blank");
  else if(platform==="x") window.open("https://twitter.com/intent/tweet?url="+encodeURIComponent(url),"_blank");
  else if(platform==="link"){
    const tempInput=document.createElement('input');
    tempInput.value=url; document.body.appendChild(tempInput); tempInput.select(); document.execCommand('copy'); document.body.removeChild(tempInput);
    showCopyPopup("‚úÖ Copied!");
  }
}
function showCopyPopup(message){
  let existing = document.getElementById("copyLinkPopup");
  if(existing) existing.remove();
  const popup = document.createElement("div");
  popup.id = "copyLinkPopup";
  popup.textContent = message;
  document.body.appendChild(popup);

  const shareBtnRect = shareBtn.getBoundingClientRect();
  const sheetRect = shareSheet.getBoundingClientRect();

  // Position relative to the share sheet
  popup.style.top = (sheetRect.bottom + window.scrollY + 10) + "px";
  popup.style.right = (window.innerWidth - sheetRect.right) + "px";
  popup.style.transform = 'translateY(-10px)';

  void popup.offsetWidth; // Force reflow for animation
  popup.classList.add('show');

  setTimeout(()=>{
    popup.classList.remove('show');
    setTimeout(()=>popup.remove(),300);
  },2000);
}

// Auto scroll helper
function scrollToBottom() {
  const chatDiv = document.getElementById("chat");
  const isNearBottom = chatDiv.scrollHeight - chatDiv.scrollTop - chatDiv.clientHeight < 100;
  if (isNearBottom && messagesDiv.children.length > 0) {
    chatDiv.scrollTop = chatDiv.scrollHeight;
  }
}

// WebSocket chat
window.TIKTALK_BACKEND = "https://tiktalk-server-8dmz.onrender.com";
const messagesDiv = document.getElementById("messages");
const input = document.getElementById("messageInput");
const sendBtn = document.getElementById("sendBtn");
const nextBtn = document.getElementById("nextBtn");
const typingIndicator = document.getElementById("typingIndicator");
const footer = document.querySelector("footer");
let ws, typingTimeout;
let isConnected = false; // New variable to track connection status

function addMessage(text, who){
  const div = document.createElement("div");
  div.className="msg "+who;
  div.textContent = text;
  messagesDiv.appendChild(div);
  scrollToBottom();
  startChattingBtn.style.display = 'none';
}

function showPopup(text){
  if (text.includes("Searching")) {
    messagesDiv.innerHTML = `
      <div class="popup">
        <div class="searching-container">
          <div class="pulse-dots"><div class="pulse-dot"></div><div class="pulse-dot"></div><div class="pulse-dot"></div></div>
          <div class="searching-text">Searching for a stranger...</div>
        </div>
      </div>`;
    isConnected = false;
  } else if (text.includes("Connected")) {
    messagesDiv.innerHTML = `
      <div class="popup"><span class="connected-checkmark"></span><span>Connected! Say Hi üëã</span></div>`;
    isConnected = true;
    setTimeout(() => { if (messagesDiv.innerHTML.includes("Connected")) messagesDiv.innerHTML = ''; }, 3000);
  } else {
    messagesDiv.innerHTML = `<div class="popup">${text}</div>`;
    if (text.includes("disconnected")) startChattingBtn.style.display = 'block';
    isConnected = false;
  }
  scrollToBottom();
}

function connectStranger(){
  showPopup("üîç Searching for a stranger...");
  typingIndicator.style.display="none";
  ws=new WebSocket(window.TIKTALK_BACKEND.replace("http","ws")+"/ws");
  ws.onmessage=(event)=>{
    try{
      const data=JSON.parse(event.data);
      if(data.type==="system"){
        if(data.text==="waiting") showPopup("üîç Searching for a stranger...");
        else if(data.text==="connected") {
            showPopup("‚úÖ Connected! Say Hi üëã");
        }
        else if(data.text==="disconnected") {
            showPopup("‚ùå Stranger disconnected");
        }
      }
      if(data.type==="message"){ typingIndicator.style.display="none"; addMessage(data.text,"stranger"); }
      if(data.type==="typing"){ typingIndicator.style.display="block"; clearTimeout(typingTimeout); typingTimeout=setTimeout(()=>{typingIndicator.style.display="none";},1500);}
    }catch{}
  };
  ws.onclose=()=>{showPopup("‚ùå Disconnected from server"); typingIndicator.style.display="none"; isConnected=false;}
}

sendBtn.addEventListener("click", ()=>{
  // Check if connected before sending
  if(isConnected && input.value.trim()){
    ws.send(JSON.stringify({type:"message", text:input.value}));
    addMessage(input.value,"me");
    input.value="";
    emojiPicker.style.display = "none";
    emojiToggle.textContent = "üòä";
  }
});
input.addEventListener("input", ()=>{
  if(isConnected && ws && ws.readyState===WebSocket.OPEN) ws.send(JSON.stringify({type:"typing"}));
});
nextBtn.addEventListener("click", ()=>{if(ws) ws.close(); connectStranger();});

// Enable smooth auto scroll for chat content only
document.body.classList.add('auto-scroll-enabled');

// Auto scroll on message div changes
const observer = new MutationObserver(() => {
  scrollToBottom();
});
observer.observe(messagesDiv, { childList: true, subtree: true });

// Connect on load
// initial state should just show the button
showPopup(" ");
startChattingBtn.style.display = 'block';

// Emoji picker
const emojiPicker = document.getElementById("emojiPicker");
const emojiToggle = document.getElementById("emojiToggle");

// Init EmojiMart
const picker = new EmojiMart.Picker({
  onEmojiSelect: e => {
    input.value += e.native;
  },
  theme: document.body.classList.contains("dark-mode") ? "dark" : "light",
  previewPosition: "none",
  skinTonePosition: "none",
  categories: ["frequent","people","nature","foods","activity","places","objects","symbols","flags"]
});
emojiPicker.appendChild(picker);
window._emojiPickerInstance = picker;

emojiToggle.addEventListener("click", (e) => {
  e.stopPropagation();
  const open = emojiPicker.style.display === "block";
  if (open) {
    emojiPicker.style.display = "none";
    emojiToggle.textContent = "üòä";
    input.focus();
  } else {
    input.blur();
    emojiPicker.style.height = "300px";
    emojiPicker.style.display = "block";
    emojiToggle.textContent = "‚å®Ô∏è";
  }
});

document.addEventListener("click", (e) => {
  if (emojiPicker.style.display === "block" && !emojiPicker.contains(e.target) && e.target !== emojiToggle) {
    emojiPicker.style.display = "none";
    emojiToggle.textContent = "üòä";
    input.focus();
  }
});

document.addEventListener("keydown", (e) => {
  if (e.key === "Escape" && emojiPicker.style.display === "block") {
    emojiPicker.style.display = "none";
    emojiToggle.textContent = "üòä";
    input.focus();
  }
});
</script>
</body>
</html>
